

2017-12-08(Friday)

    昨天做了一个 “客户端机器人” 来对服务器的的消息进行处理，这样方便在开发服务器功能时，可以提前自己测试一下功能，提高效率。

    今天想了一些，接下来服务器需要考虑的一些问题：

        1. 完善登录、货币、发言等的日志数据库记录；
        2. 游戏的状态，以后在维护的时候，必须通过信号量（或者其他方式），做关服前的逻辑；
        3. 数据库如何提高效率，也就上网查了一下，官网的一些建议，还有《高性能MySQL》只是大概了解下书讨论的内容，还没细看；
        4. 最后考虑了一下，服务器后面应该会做排行榜（战斗力、经验等等）；

    说到排行榜，就想起了之前被问过一个关于排行榜的问题，“1000w 玩家的实时排行”。
    记得当时完全按照解决问题的思路去思考这个问题，堆排序，数据全部放在内存。现在，站在玩家的角度，如果不是 top100，谁会关心自己排行几百万。然后上知乎搜了下相似的问题 https://www.zhihu.com/question/27933771，其中一个用户的回答，感觉值得借鉴考虑。

    他的回答是这样的：

    十多年的码农。
    144 人赞同了该回答

    居然有很多兄弟又是组件又是论文算法。一看就不是做游戏服务器的或者实用系统的。你们以为是多大一个事情呀？
    全服排名？请问你的服是多少人？
    1000人？随便你怎么排。冒泡算法都可以。
    1000万人？只要你的数据不是太大，更新频道不是特别高，每次更新，或者定时更新的时候排序就可以了。红黑树大致也只用找20次。内存？64位的系统还要考虑内存。就算每个用户256字节。你算算才要多少数据？256*1000W=256*10M=2.5G。
    但如果从架构上考虑，需要一台排序服务器来做这个事情。其实这也就是楼主的方法2而已。
    1亿用户？其实前面已经证明了。上面的方法是可以搞的。内存25G就可以了。一台机器也就可以了。

    10亿？全服能超过1亿用户的游戏，中国目前数估计不超过10个。CF，DNF，LOL这类还是分区游戏，不用考虑。主要是QQGAme的斗地主，天天飞车，天天酷跑，天天爱消除这类手游产品。当年如果你成了这种产品，成本看上去不再是问题了。
    增加10台机器好像也不是太大问题，只是架构上。。。。。好像更麻烦了。
    那么？
    第一，你要那么及时吗？不要，直接上DB，一天导出一次就OK了。
    第二，你要那么准确吗？忽悠用户是否可以？直接做一个很细致的分段出来就OK了。
    还是一台服务器就搞掂了。

    100亿？你不是在做游戏把。。

    最后的最后，请问一下你的策划同学，当一个用户看到自己是第2000W名的时候，他对这个排名的感想？
    什么年代了，还在用全区排序这种落后的设计。告诉你们的策划，我很BS他们。